{% extends "base.html" %}

{% block title %}Таблица студентов - Сайт студентов{% endblock %}

{% block content %}
    <h1>Таблица студентов</h1>
    <p>Всего студентов: {{ students|length }}</p>

    {% if search_query or selected_group %}
        <div class="alert" style="background-color: #e0ddf9; color: #5a4fcf; margin: 1rem 0;">
            <strong>Фильтры:</strong>
            {% if search_query %}Поиск: "{{ search_query }}"{% endif %}
            {% if selected_group %} | Группа: "{{ selected_group }}"{% endif %}
            <a href="/students" style="float: right; color: #5a4fcf;">Сбросить фильтры</a>
        </div>
    {% endif %}

    <div class="search-form" style="margin: 1.5rem 0; padding: 1rem; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(90, 79, 207, 0.1);">
        <form method="GET" action="/students" style="display: flex; gap: 1rem; align-items: flex-end;">
            <div style="flex: 1;">
                <label for="search" style="display: block; margin-bottom: 0.5rem; font-weight: bold; color: #5a4fcf;">Поиск по имени:</label>
                <input type="text" id="search" name="search"
                       placeholder="Введите имя для поиска..."
                       value="{{ search_query if search_query else '' }}"
                       style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
            </div>

            <div style="width: 200px;">
                <label for="group_filter" style="display: block; margin-bottom: 0.5rem; font-weight: bold; color: #5a4fcf;">Фильтр по группе:</label>
                <select id="group_filter" name="group" style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                    <option value="">Все группы</option>
                    {% for group in all_groups %}
                        <option value="{{ group }}" {% if selected_group == group %}selected{% endif %}>{{ group }}</option>
                    {% endfor %}
                </select>
            </div>

            <div>
                <button type="submit" class="btn" style="background-color: #10b981;">Применить</button>
                <a href="/students" class="btn btn-secondary">Сбросить</a>
            </div>
        </form>
    </div>

    <div class="actions">
        <a href="/" class="btn btn-secondary">Вернуться на главную</a>
        <a href="/add" class="btn">Добавить студента</a>
        <a href="/export/csv" class="btn" style="background-color: #10b981;">Экспорт в CSV</a>
    </div>

    {% if students %}
        <div style="overflow-x: auto; margin-top: 2rem;">
            <table style="width: 100%; border-collapse: collapse; margin: 1rem 0;">
                <thead>
                    <tr style="background-color: #5a4fcf; color: white;">
                        <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">ID</th>
                        <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Имя</th>
                        <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Возраст</th>
                        <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Группа</th>
                        <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Дата добавления</th>
                        <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Действия</th>
                    </tr>
                </thead>
                <tbody>
                    {% for student in students %}
                    <tr style="border-bottom: 1px solid #ddd; {% if loop.index % 2 == 0 %}background-color: #f8f7ff;{% endif %}">
                        <td style="padding: 12px; border: 1px solid #ddd; text-align: center; font-weight: bold;">{{ student.id }}</td>
                        <td style="padding: 12px; border: 1px solid #ddd;">{{ student.name }}</td>
                        <td style="padding: 12px; border: 1px solid #ddd;">{{ student.age }} лет</td>
                        <td style="padding: 12px; border: 1px solid #ddd;">
                            {{ student.group if student.group else '-' }}
                        </td>
                        <td style="padding: 12px; border: 1px solid #ddd;">
                            {% if student.created_at is string %}
                                {{ student.created_at[:10] }}
                            {% else %}
                                {{ student.created_at.strftime('%d.%m.%Y') }}
                            {% endif %}
                        </td>
                        <td style="padding: 12px; border: 1px solid #ddd;">
                            <a href="/edit/{{ student.id }}" class="btn"
                               style="padding: 4px 8px; font-size: 0.8rem; background-color: #f59e0b;">
                                Редактировать
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="alert">
            <p>Пока нет студентов. <a href="/add">Добавьте первого!</a></p>
        </div>
    {% endif %}
{% endblock %}